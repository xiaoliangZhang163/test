# 数据库基础

## 一.ACID

### 1.1 全称及含义

​		事务四特性（ACID),数据库事务是由一系列数据库操作（一个或多个操作）组成的程序执行单元。

​		A -- automacity，原子性
​		C -- consistency, 一致性
 		I  -- isolation, 隔离性
 		D -- durability, 持久性

###  1.2 详细解释：

 		原子性：一个事务中的所有操作，要么全部完成，要么全部不完成。不会结束在事务的某个中间环节。事务在执行过程中，发生错误，会被回滚到事务开始前的状态。
 		一致性：在事务开始前和事务结束之后，数据库的完整性没有被破坏。
 		隔离性：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。
 		持久性：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

### 1.3 事务并发三个问题

（1）脏读：事务A读取事务B更新的数据，然后B回滚操作，A读取到的是脏数据；
（2）不可重复读：事务 A 多次读取同一数据，事务 B 在事务A读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果不一致；
（3）幻读：系统管理员A更改数据库中学生成绩分数为ABCDE等级，但管理员B在这时仍然插入一条分数的记录，A更改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读（某一事务更改的时候其他事务也操作了，更改事务对新操作的数据不起作用）。

### 1.4 事务隔离级别

（1）读取未提交：一个事务可以读取另一个未提交事务的数据。产生问题：脏读。
（2）读取提交：只有一个事务提交以后，其他事务才能读取。可避免脏读。
（3）可重复读：事务一旦读取后不可再修改。避免不可重复读问题。
（4）可串行化：可以避免脏读、不可重复读与幻读所有问题，但效率低下，不用。

## 二.NULL

## 三.MVCC

### 3.1 概念

​		MVCC，Multi-Version Concurrency Control，多版本并发控制。MVCC 是一种并发控制的方法，一般在数据库管理系统中，实现对数据库的并发访问；在编程语言中实现事务内存；**用于实现读取已提交和可重复读两种隔离级别；通过保存数据在某个时间点的快照来实现**。

​		一句话讲，MVCC就是用 **`同一份数据临时保留多版本的方式`** 的方式，实现并发控制。

这里留意到 MVCC 关键的两个点：

1. 在读写并发的过程中如何实现多版本；
2. 在读写并发之后，如何实现旧版本的删除（毕竟很多时候只需要一份最新版的数据就够了）；

### 3.2 实现

​		MVCC 使用时间戳（TS）、递增的事务 ID（T）实现事务一致性。

​		MVCC 通过维护多版本数据，保证一个读事务永远不会被阻塞。对象 P 维护有多个版本，每个版本会有一个读时间戳（Read TimeStamp, RTS）和 写时间戳（Write TimeStamp, WTS），事务 Ti 读对象 P 的最新版本，该版本早于事务 Ti 的读时间戳 RTS(Ti)。

​		事务 Ti 要对 P 执行写操作，如果有其他事务 Tk 同时对 P 操作，则 RTS(Ti）必须要早于 RTS(Tk)，即有 RTS(Ti) < RTS(Tk)，这样对 Ti 对 P 的写操作才能完成。一般地，如果其他事务拥有 P 的一个更早的读时间戳的情况下，写操作是不能完成的。打个比方就是在存储前面有一道线，只有等你前面的人的完成了他们的事务，你的修改事务才可以提交完成。

​		重复说一下：每个对象 P 有一个时间戳 TS，如果事务 Ti 想要对 P 执行写操作，（写要先读）事务的读时间戳是 RTS(Ti)，如果有其他事务拥有一个比较早的时间戳，有 TS(P) < RTS(Ti)，这时事务 Ti 会退出并重新开始。否则，事务 Ti 创建一个 P 的新版本，并设置新版本 P 的时间戳，似的 TS = TS(Ti)。

​		MVCC 系统明显的缺点是会存储多个版本数据的冗余开销。但同时，读操作永不会被阻塞，这对那些以读操作为主的数据库来说非常重要。MVCC 实现了真的快照隔离（snapshot isolation），然后其他的并发控制方法要么是不完整的快照隔离方式，要么需要较高的性能损耗。

## 四.约束

​	数据库中的五大约束包括：

​		1.主键约束（Primay Key Coustraint） 唯一性，非空性；

​		2.唯一约束 （Unique Counstraint）唯一性，可以空，但只能有一个；

​		3.默认约束 (Default Counstraint) 该数据的默认值；

​		4.外键约束 (Foreign Key Counstraint) 需要建立两表间的关系；

  	  5.非空约束（Not Null Counstraint）:设置非空约束，该字段不能为空。

## 五.概念模型

​		概念数据模型：也成为信息模型，其实质是面向用户，它是用户所容易理解的现实世界特征的数据抽象，其基本特征是按照用户观点对数据黑信息进行建模，而与具体的DBMS无关。概念数据模型作为数据库设计人员与用户之间进行交流的基本工具，服务于数据库设计的应用目的。概念数据模型建模的基本方法是E-R方法


## 六.第三范式

### 1.数据库范式

​		1NF:原子性,列不可再分
​		2NF:第二范式依赖第一范式，所以第二范式必须符合第一，然后第二范式需要确保数据库表中的每一列都和主键相关
​		3NF:在第二范式的基础上更进一层,目标是确保每列都和主键列直接相关,而不是间接相关(另外非主键列必须直接依赖于主键，不能存在传递依赖)。

## 七.连接

### 7.1 左外连接

对应的SQL语句：left （outer）join，outer可以省略。

表示的含义：例如：A、B两张表，A表为基础表，B表为补充表，则：

select * from A left join B on A.id = B.id（理解为A加到B的左边）。

用 + 来表示：select * from A , B where A.id = B.id(+)   [+在哪边，哪边就是补充表，即A为基础表，B为补充表，A表的数据全部显示，B表的数据只有与A表相匹配的才显示，不匹配的均为NULL]

### 7.2 右外连接

对应的SQL语句：right（outer）join，outer可以省略。

表示的含义：select * from A right join B on A.id = B.id（理解为A加到B的右边）

用 + 表示：select * from A , B where A.id(+) = B.id [即B为基础表，A为补充表。B的数据全部显示，A的数据只显示与B匹配的，不匹配的均为NULL]

总结：

①左、右外连接中，+ 号在哪个表中，哪个表就是补充表，+ 号在左，就是右连接；+ 号在右，就是左连接。

② (+) 号的SQL语句和 left/right join语句是不同的，left/right join 可以和on连用，而 + 只能出现在where子句中。

③ (+) 号只适用于列，而不能用在表达式中。

④ (+) 号只能用于左外连接、右外连接，而不能用于实现完全外链接。

### 7.3 完全外链接

对应的SQL语句：select * from  A full (outer) join B on A.id = B.id 

表示的含义：左表和右表都不做限制，所有的记录都显示，两表不足的地方均为NULL，全外连接不能用 (+) 表示。

### 7.4 内连接

内连接，也称为等值连接，返回两张表都满足条件的部分，相当于select … from … where

### 7.5 交叉连接

交叉连接：返回左表中的所有行，左表中的每一行与右表中的所有行组合。交叉联接也称作笛卡尔积